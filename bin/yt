#! /bin/bash

set -eu

VERSION="0.1.2"

CMD_DIR=

_init_cmd_dir() {
    CMD_DIR=`dirname $0`/../lib/yt/commands
    test -d ${CMD_DIR} && return

    CMD_DIR=`dirname $0`/../src/commands
    test -d ${CMD_DIR}
}


main() {
	_init_cmd_dir
	local cmds

	usage() {
		local cmds
		cmds=`ls $CMD_DIR`
		echo "Usage: $0 [-x] <command> [<cmd args>]"
		echo "-x  performs \`set -x\` before running <command>"
		echo "Commands:"
		for i in $cmds ; do
			echo ${i%.sh}
		done
		exit 1
	}

	[ $# -eq 0 ] && usage

	version() {
		echo $VERSION
	}

	local x
	x=0
	while getopts xV name
	do
		case $name in
			x) x=1;;
			V) version; exit 0;;
			?) usage
		esac
	done

	shift $((OPTIND - 1))

	[ $x -eq 1 ] && set -x

	cmd=$CMD_DIR/$1

	shift
	$cmd "$@"
}

main $@
